import cv2
import numpy as np
import os

def load_image(filepath: str) -> np.ndarray:
    """
    Load image safely.
    
    LIMITATION: This educational version only supports 8-bit standard formats (JPG, PNG, BMP).
    Industrial formats (TIFF, RAW, 16-bit) are not supported.
    """
    if not os.path.exists(filepath):
        raise FileNotFoundError(f"Image not found: {filepath}")
        
    # Check for industrial formats
    ext = os.path.splitext(filepath)[-1].lower()
    if ext in ['.tif', '.tiff', '.raw', '.dng']:
        raise NotImplementedError(
            "16-bit/RAW format support is not available in the Reference Edition. "
            "Please upgrade to AWLF-Fast for industrial data support."
        )
        
    # Force load as grayscale 8-bit
    img = cv2.imread(filepath, cv2.IMREAD_GRAYSCALE)
    
    if img is None:
        raise ValueError("Failed to load image. File might be corrupted.")
        
    return img

def save_image(filepath: str, img: np.ndarray):
    """Save result to disk."""
    cv2.imwrite(filepath, img)

